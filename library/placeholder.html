<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Placeholder Image Service</title>
    <!-- Tailwind CSS CDN for modern styling and responsiveness -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a clean, modern look */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Hide canvas elements by default, they are used for generation */
        canvas {
            display: none;
        }
        /* Ensure the main container takes full width on small screens */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem; /* Responsive padding */
        }
        /* Specific styling for the demo canvas elements to make them visible */
        .demo-item canvas {
            display: block; /* Make demo canvases visible */
            border-radius: 0.5rem; /* Rounded corners */
            margin-bottom: 1rem; /* Spacing below canvas */
            max-width: 100%; /* Ensure it fits its container */
            height: auto; /* Maintain aspect ratio */
            border: 2px dashed #e2e8f0; /* Dashed border for demo */
        }
        /* Styling for the generated image canvas */
        #generatedResult canvas {
            display: block; /* Make generated canvas visible */
            border-radius: 0.5rem;
            margin: 1rem auto; /* Center it with margin */
            max-width: 100%;
            height: auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); /* Subtle shadow */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-600 to-purple-700 min-h-screen flex flex-col items-center justify-center text-gray-800">

    <!-- Main content container for the interactive page -->
    <div id="mainContent" class="container bg-white rounded-xl shadow-2xl p-6 md:p-10 lg:p-12 my-8 w-11/12 md:w-4/5 lg:w-3/4 xl:w-2/3 hidden">
        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-indigo-700 mb-2">
                üñºÔ∏è Dynamic Placeholder Images
            </h1>
            <p class="text-lg md:text-xl text-gray-600">
                Generate custom placeholder images on the fly via URL or interactive form.
            </p>
        </header>

        <!-- Live Examples Section -->
        <section class="mb-10">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-700 mb-6">Live Examples</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Example 1 -->
                <div class="demo-item bg-blue-50 p-6 rounded-lg shadow-md flex flex-col items-center text-center transition-transform duration-300 hover:scale-105 hover:shadow-lg">
                    <canvas id="demo1"></canvas>
                    <div class="url bg-gray-800 text-white text-sm md:text-base p-2 rounded-md break-all font-mono mb-3 w-full">
                        300x200/blue/white
                    </div>
                    <p class="text-gray-700 text-sm">Basic placeholder with custom colors.</p>
                </div>
                <!-- Example 2 -->
                <div class="demo-item bg-red-50 p-6 rounded-lg shadow-md flex flex-col items-center text-center transition-transform duration-300 hover:scale-105 hover:shadow-lg">
                    <canvas id="demo2"></canvas>
                    <div class="url bg-gray-800 text-white text-sm md:text-base p-2 rounded-md break-all font-mono mb-3 w-full">
                        400x300/ff6b6b/ffffff?text=Hello World
                    </div>
                    <p class="text-gray-700 text-sm">Custom text with hex colors.</p>
                </div>
                <!-- Example 3 -->
                <div class="demo-item bg-purple-50 p-6 rounded-lg shadow-md flex flex-col items-center text-center transition-transform duration-300 hover:scale-105 hover:shadow-lg">
                    <canvas id="demo3"></canvas>
                    <div class="url bg-gray-800 text-white text-sm md:text-base p-2 rounded-md break-all font-mono mb-3 w-full">
                        350x250/gradient/white
                    </div>
                    <p class="text-gray-700 text-sm">Gradient background example.</p>
                </div>
            </div>
        </section>

        <!-- API Usage Section -->
        <section class="bg-gray-100 p-6 rounded-lg shadow-inner mb-10">
            <h3 class="text-xl md:text-2xl font-bold text-gray-700 mb-4">üîó API Usage</h3>
            <p class="text-gray-700 mb-4">Generate placeholder images by appending URL parameters to this page's URL:</p>
            <pre class="bg-gray-800 text-green-300 p-4 rounded-md overflow-x-auto text-sm md:text-base mb-4">
<span id="baseUrlDisplay"></span>?width=300&height=200&bg=blue&text=Hello&color=white
            </pre>

            <h4 class="text-lg md:text-xl font-semibold text-gray-700 mb-3">URL Parameters:</h4>
            <ul class="list-disc list-inside text-gray-700 mb-4 space-y-1">
                <li><code class="font-mono bg-gray-200 p-1 rounded">width</code> - Image width in pixels (default: 300)</li>
                <li><code class="font-mono bg-gray-200 p-1 rounded">height</code> - Image height in pixels (default: 200)</li>
                <li><code class="font-mono bg-gray-200 p-1 rounded">bg</code> - Background color (hex code like `ff00ff`, named color like `red`, or `gradient`)</li>
                <li><code class="font-mono bg-gray-200 p-1 rounded">color</code> - Text color (hex code or named color, default: white)</li>
                <li><code class="font-mono bg-gray-200 p-1 rounded">text</code> - Custom text to display (default: dimensions)</li>
                <li><code class="font-mono bg-gray-200 p-1 rounded">format</code> - Image format: `png`, `jpg`, `webp` (default: `png`)</li>
            </ul>

            <h4 class="text-lg md:text-xl font-semibold text-gray-700 mb-3">Example URLs:</h4>
            <pre class="bg-gray-800 text-green-300 p-4 rounded-md overflow-x-auto text-sm md:text-base">
<span id="exampleUrl1"></span>
<span id="exampleUrl2"></span>
<span id="exampleUrl3"></span>
            </pre>
        </section>

        <!-- Interactive Image Generator Section -->
        <section class="bg-blue-50 p-6 rounded-lg shadow-md mb-10">
            <h3 class="text-xl md:text-2xl font-bold text-blue-800 mb-6">üé® Image Generator</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-6">
                <div class="form-group">
                    <label for="width" class="block text-gray-700 font-semibold mb-1">Width (px)</label>
                    <input type="number" id="width" value="300" min="50" max="2000" class="w-full p-2 border-2 border-blue-200 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 transition duration-200">
                </div>
                <div class="form-group">
                    <label for="height" class="block text-gray-700 font-semibold mb-1">Height (px)</label>
                    <input type="number" id="height" value="200" min="50" max="2000" class="w-full p-2 border-2 border-blue-200 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 transition duration-200">
                </div>
                <div class="form-group">
                    <label for="bgColor" class="block text-gray-700 font-semibold mb-1">Background Color</label>
                    <input type="text" id="bgColor" value="4a90e2" placeholder="hex, named color, or 'gradient'" class="w-full p-2 border-2 border-blue-200 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 transition duration-200">
                </div>
                <div class="form-group">
                    <label for="textColor" class="block text-gray-700 font-semibold mb-1">Text Color</label>
                    <input type="text" id="textColor" value="white" placeholder="hex or named color" class="w-full p-2 border-2 border-blue-200 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 transition duration-200">
                </div>
            </div>
            <div class="form-group mb-6">
                <label for="customText" class="block text-gray-700 font-semibold mb-1">Custom Text</label>
                <input type="text" id="customText" placeholder="Leave empty for dimensions" class="w-full p-2 border-2 border-blue-200 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 transition duration-200">
            </div>
            <div class="form-group mb-6">
                <label for="format" class="block text-gray-700 font-semibold mb-1">Format</label>
                <select id="format" class="w-full p-2 border-2 border-blue-200 rounded-md focus:border-blue-500 focus:ring focus:ring-blue-200 transition duration-200">
                    <option value="png">PNG</option>
                    <option value="jpg">JPG</option>
                    <option value="webp">WebP</option>
                </select>
            </div>
            <button onclick="generateImage()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
                Generate Image
            </button>
            <div id="generatedResult" class="generated-result mt-6 p-4 bg-white border-2 border-blue-200 rounded-lg text-center hidden">
                <!-- Generated image and URL will be inserted here -->
            </div>
        </section>

        <!-- Footer Section -->
        <footer class="text-center text-gray-500 text-sm mt-8">
            <p>&copy; 2025 Dynamic Placeholder Image Service. All rights reserved.</p>
            <p>Built with ‚ù§Ô∏è for developers.</p>
        </footer>
    </div>

    <script>
        /**
         * Helper function to parse URL parameters from the current window location.
         * @returns {object} An object containing parsed parameters.
         */
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                width: parseInt(params.get('width')),
                height: parseInt(params.get('height')),
                bg: params.get('bg'),
                color: params.get('color'),
                text: params.get('text'),
                format: params.get('format') || 'png' // Default to png if not specified
            };
        }

        /**
         * Converts a color string (hex, named, or hex without #) to a valid CSS color.
         * Handles the special 'gradient' keyword.
         * @param {string} color - The color string.
         * @returns {string} The formatted CSS color or 'gradient'.
         */
        function formatColor(color) {
            if (color === 'gradient') {
                return 'gradient';
            }
            // If it's a named color or already has '#', return as is.
            // Using CSS.supports to check for named colors is a robust way.
            if (color && (CSS.supports('color', color) || color.startsWith('#'))) {
                return color;
            }
            // Assume it's a hex without '#' if it's a valid hex string
            if (color && /^[0-9a-fA-F]{3,6}$/.test(color)) {
                return `#${color}`;
            }
            // Fallback for invalid or empty colors
            return '#cccccc'; // A neutral grey
        }

        /**
         * Draws a placeholder image onto a given canvas element.
         * This function does not return a data URL; it modifies the canvas directly.
         * @param {HTMLCanvasElement} canvas - The canvas element to draw on.
         * @param {number} width - The width of the image.
         * @param {number} height - The height of the image.
         * @param {string} bgColor - The background color (hex, named, or 'gradient').
         * @param {string} textColor - The text color (hex or named).
         * @param {string} text - The custom text to display.
         */
        function drawPlaceholderOnCanvas(canvas, width, height, bgColor, textColor, text) {
            const ctx = canvas.getContext('2d');
            canvas.width = width;
            canvas.height = height;

            // Set background
            if (bgColor === 'gradient') {
                const gradient = ctx.createLinearGradient(0, 0, width, height);
                gradient.addColorStop(0, '#667eea'); // Start color of gradient
                gradient.addColorStop(1, '#764ba2'); // End color of gradient
                ctx.fillStyle = gradient;
            } else {
                ctx.fillStyle = formatColor(bgColor);
            }
            ctx.fillRect(0, 0, width, height);

            // Add text
            const displayText = text || `${width} √ó ${height}`;
            ctx.fillStyle = formatColor(textColor);

            // Calculate font size dynamically based on the smaller dimension
            const fontSize = Math.min(width, height) * 0.1; // 10% of the smaller dimension
            ctx.font = `bold ${fontSize}px Inter, Arial, sans-serif`; // Use Inter, fallback to Arial
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // Add text shadow for better readability against various backgrounds
            ctx.shadowColor = 'rgba(0,0,0,0.4)';
            ctx.shadowBlur = 3;
            ctx.shadowOffsetX = 1;
            ctx.shadowOffsetY = 1;

            ctx.fillText(displayText, width / 2, height / 2);
        }

        /**
         * Initializes the demo images on the main page.
         * This runs only when the page is loaded without URL parameters.
         */
        function initDemoImages() {
            const demos = [
                { id: 'demo1', width: 300, height: 200, bg: '4a90e2', color: 'white', text: '' },
                { id: 'demo2', width: 400, height: 300, bg: 'ff6b6b', color: 'ffffff', text: 'Hello World' },
                { id: 'demo3', width: 350, height: 250, bg: 'gradient', color: 'white', text: '' }
            ];

            demos.forEach(demo => {
                const canvas = document.getElementById(demo.id);
                if (canvas) { // Ensure canvas exists before drawing
                    drawPlaceholderOnCanvas(canvas, demo.width, demo.height, demo.bg, demo.color, demo.text);
                }
            });
        }

        /**
         * Handles image generation from the interactive form.
         * Displays the generated image and its URL on the page.
         */
        function generateImage() {
            // Get values from form inputs
            const width = parseInt(document.getElementById('width').value);
            const height = parseInt(document.getElementById('height').value);
            const bgColor = document.getElementById('bgColor').value;
            const textColor = document.getElementById('textColor').value;
            const customText = document.getElementById('customText').value;
            const format = document.getElementById('format').value;

            // Validate inputs (basic validation)
            if (isNaN(width) || isNaN(height) || width < 50 || height < 50) {
                alert('Please enter valid width and height (minimum 50px).');
                return;
            }

            // Create a temporary canvas to draw the image
            const tempCanvas = document.createElement('canvas');
            drawPlaceholderOnCanvas(tempCanvas, width, height, bgColor, textColor, customText);

            // Get the data URL from the temporary canvas
            const dataUrl = tempCanvas.toDataURL(`image/${format}`);

            // Construct the URL for direct access (for copy-pasting)
            const baseUrl = window.location.origin + window.location.pathname;
            const params = new URLSearchParams();
            params.append('width', width);
            params.append('height', height);
            params.append('bg', bgColor);
            params.append('color', textColor);
            if (customText) {
                params.append('text', customText);
            }
            params.append('format', format);
            const generatedUrl = `${baseUrl}?${params.toString()}`;

            // Display the generated image and URL in the result section
            const resultDiv = document.getElementById('generatedResult');
            resultDiv.innerHTML = `
                <img src="${dataUrl}" alt="Generated Placeholder" class="mx-auto rounded-md shadow-lg border-2 border-blue-300 mb-4 max-w-full h-auto">
                <div class="bg-gray-800 text-white text-sm md:text-base p-3 rounded-md break-all font-mono mb-4">
                    ${generatedUrl}
                </div>
                <button onclick="copyToClipboard('${generatedUrl}')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 mr-2">
                    Copy URL
                </button>
                <button onclick="downloadImage('${dataUrl}', '${format}')" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-300">
                    Download Image
                </button>
            `;
            resultDiv.classList.remove('hidden'); // Show the result section
        }

        /**
         * Copies text to the clipboard.
         * @param {string} text - The text to copy.
         */
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                alert('URL copied to clipboard!'); // Using alert for simplicity, consider custom modal for production
            } catch (err) {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy URL. Please copy manually: ' + text);
            }
            document.body.removeChild(textarea);
        }

        /**
         * Downloads the generated image.
         * @param {string} dataUrl - The data URL of the image.
         * @param {string} format - The format of the image (e.g., 'png', 'jpg').
         */
        function downloadImage(dataUrl, format) {
            const link = document.createElement('a');
            link.download = `placeholder.${format}`;
            link.href = dataUrl;
            document.body.appendChild(link); // Required for Firefox
            link.click();
            document.body.removeChild(link); // Clean up
        }

        /**
         * Handles the initial page load. If URL parameters are present, it generates
         * the image and redirects the browser to the image data URL. Otherwise, it
         * displays the interactive generator page.
         */
        function handleInitialLoad() {
            const params = getUrlParams();
            const hasImageParams = params.width || params.height || params.bg || params.text || params.color;

            if (hasImageParams) {
                // If image parameters are present, generate the image and redirect
                const width = params.width || 300;
                const height = params.height || 200;
                const bg = params.bg || 'cccccc'; // Default grey background for direct image access
                const color = params.color || 'white';
                const text = params.text || '';
                const format = params.format || 'png';

                const tempCanvas = document.createElement('canvas');
                drawPlaceholderOnCanvas(tempCanvas, width, height, bg, color, text);
                const dataUrl = tempCanvas.toDataURL(`image/${format}`);

                // Redirect the browser to the data URL. This makes the URL itself become the image.
                window.location.replace(dataUrl);
            } else {
                // If no image parameters, show the interactive generator page
                document.getElementById('mainContent').classList.remove('hidden');
                initDemoImages(); // Initialize demo images for the interactive page

                // Populate base URL and example URLs for the API section
                const baseUrl = window.location.origin + window.location.pathname;
                document.getElementById('baseUrlDisplay').textContent = baseUrl;
                document.getElementById('exampleUrl1').textContent = `${baseUrl}?width=400&height=300&bg=ff6b6b&text=Placeholder`;
                document.getElementById('exampleUrl2').textContent = `${baseUrl}?width=500&height=400&bg=gradient&color=black&text=Beautiful%20Image`;
                document.getElementById('exampleUrl3').textContent = `${baseUrl}?width=600&height=200&bg=2196f3&color=white&format=jpg`;
            }
        }

        // Run the initial load handler when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', handleInitialLoad);
    </script>
</body>
</html>
